# Advanced Developing on AWS 受講メモ 2日目
AWSのクラスルームトレーニング「Advanced Developing on AWS」の受講メモ。

## メモ
- Lambdaのハンドラ関数外のコードは、コールドスタート時に一度だけ実行される。
  （この辺りはDeveloping Serverless Solutions on AWSでも出てきたなあ）
    - リソースオブジェクトの生成等、一度だけ実行すればよいコードをハンドラ関数外に書くことでオーバーヘッドを低減できる。
- /tmpディレクトリ内のコンテンツは、実行環境が残っていれば再利用できる。
    - キャッシュに使えるかもしれない？
    - 他の受講者の方によれば：
      \/tmp以下のファイルは逆に残る事で問題になったりする。同名ファイルが無い前提の処理系とか。再利用される事で\/tmpの容量がパンクした事もある。SSMやSecretsはLambdaのライフタイムが想定より長くて、再取得が行われずエラーになった事もあった。…とのこと。
- Lambda Layerで用意したboto3を使うようにすれば、「システム全体にインストールされるパッケージが暗黙的に存在することに決して依存しない。」を満たせる。
  ※明示的に指定しなければ、AWS Lambdaのランタイムに含まれているboto3が使われる。このboto3は定期的に更新されるので、これによって予期しない問題が発生する可能性がある。
- AWS Lambda Power Tuning：性能テストができる
- 講師の方によればSnapStartコールドスタートに掛かる時間がおおよそ半分程度になるとのこと。
- Visual Studioで、Lambda関数をひな形から作れる。便利。
- https://aws.amazon.com/jp/builders-flash/202308/learn-lambda-function-execution/?awsf.filter-name=*all
- https://aws.amazon.com/jp/builders-flash/202309/learn-lambda-iam-policies/
- [ストラングラーフィグアプリケーションパターンを体感できるハンズオン](https://aws.amazon.com/jp/getting-started/projects/break-monolith-app-microservices-ecs-docker-ec2/)
- ポリグロットパーシステンス：データストアを要件やデータの特性に応じて選択しようということ
  例えば、Database per serviceパターンを採用した場合、サービス毎にデータストアが必要になる。
  そういう時に、データストアの種類を無理に統一せずに、それぞれのサービスに適したデータストアを選択するのが良い。
- 整合性を取るために2フェーズコミットを使いたいとなると、これに対応したRDBを使わなければならなくなり、
  ポリグロットパーシステンスが崩れる。
  そこで、Sagaを使う。
- 補償トランザクションが失敗したらどうする？（受講者への質問）
    - 何回かリトライするようにしておく
    - 定期的にバッチ処理を実行して整合性をとる
    - 冪等性の考慮と処理のリトライ
    - 保証トランザクションの失敗を監視して検知したら再度トランザクション処理
    - 運用でカバー
    - 失敗したことに気付いて個別対応できるように、失敗したら通知が来るようにする
      ※このように、最終的に人の手で対応することをヒューリスティック対応と呼ぶ。
    - トランザクション自体を管理するサービスを1個作って、dirtyなトランザクションを記録して処理できるようにする

## 気になったキーワード
- グラフデータベース（そういえばどういうものなのかよく分からない…）
